(function(){var e=10;var t="black";var n="objktiv-session-store";var a=["red","orange","yellow","green","blue","purple","black","white"];var s={nightModeActive:false,itemsPerPage:e,viewerBgColor:t,galleryIndex:0,galleryMap:{}};var i={default:JSON.parse(JSON.stringify(s))};var o=window.localStorage.getItem(n);var r;if(!o){var l=JSON.stringify(i);window.localStorage.setItem(n,JSON.stringify(i));o=JSON.parse(l)}else{o=JSON.parse(o)}var d={wallet:{},isSyncingWallet:true,isLastPage:false,itemsPerPage:e,skipCounts:{hic:0,fxhash:0},pageSkips:[],session:o.default};var p=JSON.parse(JSON.stringify(d));var c=beacon.DAppClient;var u;I();S();const m=new URLSearchParams(window.location.search);const g=Object.fromEntries(m.entries());if(g.ipfs){w(function(e){if(!e){return false}p.session=o[p.wallet.address]||p.session;I();var t=p.session.viewerBgColor;document.getElementById("selected-bg-color").style.background=t;document.getElementById("viewer-window-content").style.background=t});if(g.title){console.log(g.title);document.title=g.title;document.getElementById("objkt-name").innerHTML=g.title}if(g.issuer){document.getElementById("objkt-name").innerHTML=document.getElementById("objkt-name").innerHTML+'<br id="objkt-title-break"><span id="objkt-title-space">&nbsp;</span>by '+g.issuer}if(g.night){x(g.night==="true")}var f=g.bg||p.session.viewerBgColor;document.getElementById("selected-bg-color").style.background=f;document.getElementById("viewer-window-content").style.background=f;for(let e=0;e<a.length;e++){B(a[e])}document.getElementById("nav").classList.add("hidden");document.getElementById("header").classList.add("hidden");document.getElementById("footer").classList.add("hidden");document.getElementById("footer-push").classList.add("hidden");document.getElementById("viewer-window").classList.remove("hidden");var y=g.ipfs;var h=g.type;var v={image:'<div id="image-resource" style="background-image: url('+y+')"></div>',video:'<video id="video-resource" autoplay loop controls muted><source src="'+y+'"></video>',model:'<model-viewer id="model-resource" src="'+y+'" camera-controls ar ar-modes="webxr scene-viewer quick-look"></model-viewer>'};var b=h.split("/")[0];if(v[b]){document.getElementById("viewer-window-content").innerHTML=v[b]}else{var k=document.createElement("iframe");k.setAttribute("id","interactive-resource");document.getElementById("viewer-window-content").appendChild(k);k.setAttribute("src",y)}return true}if(g.tz){p.wallet={address:g.tz,anonymous:true};var E;if(g.gallery){E=decodeURIComponent(g.gallery);p.galleryJSON=E=JSON.parse(E)}w(function(e){if(!e||!g.gallery||p.wallet.address!==g.tz){p.wallet={address:g.tz,anonymous:true};document.getElementById("header-cta").classList.remove("hidden");document.getElementById("sync").classList.add("hidden");document.getElementById("galleries-link").classList.add("hidden");document.getElementById("wallet-lookup-container").classList.add("hidden")}else{p.session=o[p.wallet.address]||p.session;I();M()}N(E).then(console.log,console.log)})}else{w(function(e){if(!e){return false}p.session=o[p.wallet.address]||p.session;I();M();return N().then(resolve,reject)})}function w(t){r=p.walletClient=new c({name:"OBJKTIV",eventHandlers:{ACTIVE_ACCOUNT_SET:{handler:function(e){console.log("ACTIVE ACCOUNT SET",e);p.isSyncingWallet=false;if(!e||!e.address){return t(false)}p.wallet=e;t(true)}}}});r.subscribeToEvent(beacon.BeaconEvent.PERMISSION_REQUEST_ERROR,()=>{console.log("permissions request aborted");p.isSyncingWallet=false});r.subscribeToEvent(beacon.BeaconEvent.PERMISSION_REQUEST_SENT,()=>{console.log("permissions request aborted");p.isSyncingWallet=false});r.subscribeToEvent(beacon.BeaconEvent.PERMISSION_REQUEST_SUCCESS,()=>{console.log("permissions request aborted");p.isSyncingWallet=false});r.subscribeToEvent(beacon.BeaconEvent.NO_PERMISSIONS,()=>{console.log("permissions request aborted");p.isSyncingWallet=false});r.subscribeToEvent(beacon.BeaconEvent.PERMISSION_REQUEST_SENT,()=>{console.log("permissions request aborted");p.isSyncingWallet=false})}function I(){if(p.session.nightModeActive){document.body.classList.add("night");p.isNightModeActive=p.session.nightModeActive}if(p.session.itemsPerPage){document.getElementById("items-per-page").innerText=p.session.itemsPerPage;p.itemsPerPage=p.session.itemsPerPage}}function L(){var e=["üå¥","üçï","üéôÔ∏è","‚ù§Ô∏è","üî•","üîà","üìª","üéµ","üé∂"];return e[Math.floor(Math.random()*e.length)]}function B(i){const e=document.getElementById("bg-color-picker-menu");const t=document.createElement("div");t.style.background=i;t.classList.add("color-option");t.setAttribute("data-color",i);t.addEventListener("click",function(){p.session.viewerBgColor=i;D();document.getElementById("viewer-window-content").style.background=i;document.getElementById("selected-bg-color").style.background=i;var e=window.location.href.split("?");var t=e[1];var n=null;if(t){t=new URLSearchParams(t);t.delete("bg");var s=i;if(a.indexOf(s)===-1){s="#"+s}n=e[0]+"?"+t.toString()+"&bg="+encodeURIComponent(s);window.history.pushState({},document.title,n)}C()});e.appendChild(t)}function C(){p.viewerColorMenuOpen=false;document.getElementById("bg-color-picker-menu").classList.add("hidden");document.getElementById("hex-color-picker-container").classList.add("hidden")}function S(){document.getElementById("title-subheading").addEventListener("click",function(){window.location.href=window.location.href.split("#")[0].split("?")[0]});document.getElementById("title").addEventListener("click",function(){window.location.href=window.location.href.split("#")[0].split("?")[0]});document.getElementById("galleries-link").addEventListener("click",function(e){j();e.preventDefault()});document.getElementById("gallery-list-exit").addEventListener("click",function(){document.getElementById("gallery-list-container").classList.add("hidden")});var t=function(e){var t=document.getElementById("new-gallery-input").textContent;if(t){document.getElementById("new-gallery-input").textContent="";p.session.galleryMap[p.session.galleryIndex]={displayName:t,hic:[],fxhash:[]};p.session.galleryIndex+=1;D();q()}e.stopPropagation();e.preventDefault()};document.getElementById("new-gallery-input").addEventListener("keypress",function(e){if(e.code&&e.code==="Enter"||e.keyCode&&e.keyCode===13){e.preventDefault();t()}});document.getElementById("new-gallery-submit").addEventListener("click",t);document.getElementById("selected-bg-color").addEventListener("click",function(e){if(!p.viewerColorMenuOpen){A();p.viewerColorMenuOpen=true}else{C()}e.stopPropagation()});var n=function(){let e=document.getElementById("hex-color-picker").textContent;e=e.replace("#","");if(e.length===3||e.length===6){document.getElementById("selected-bg-color").style.background="#"+e;document.getElementById("viewer-window-content").style.background="#"+e;p.session.viewerBgColor="#"+e;D();B("#"+e);var t=window.location.href.split("?");var n=t[1];var s=null;if(n){n=new URLSearchParams(n);n.delete("bg");var i=e;if(a.indexOf(i)===-1){i="#"+i}s=t[0]+"?"+n.toString()+"&bg="+encodeURIComponent(i);window.history.pushState({},document.title,s)}}C()};document.getElementById("hex-color-picker").addEventListener("keypress",function(e){if(e.code&&e.code==="Enter"||e.keyCode&&e.keyCode===13){e.preventDefault();n()}});document.getElementById("hex-color-picker-submit").addEventListener("click",n);document.getElementById("wallet-lookup-input").addEventListener("input",function(){const e=document.getElementById("wallet-lookup-input").innerText;document.getElementById("wallet-lookup-input").innerHTML="";document.getElementById("wallet-lookup-input").innerText="";document.getElementById("wallet-lookup-input").innerText=e.replace("\n","")},false);var s=function(){var e=document.getElementById("wallet-lookup-input").textContent;if(e){window.location.href=window.location.href.split("?")[0].replace("#","")+"?tz="+e}};document.getElementById("wallet-lookup-input").addEventListener("keypress",function(e){if(e.code&&e.code==="Enter"||e.keyCode&&e.keyCode===13){e.preventDefault();s()}});document.getElementById("wallet-lookup-submit").addEventListener("click",s);document.getElementById("exit-anon").addEventListener("click",function(e){e.preventDefault();window.location.href=window.location.href.split("?")[0]});document.getElementById("day-night-toggle").addEventListener("click",function(e){if((document.body.getAttribute("class")||"").indexOf("night")===-1){x(true)}else{x(false)}e.preventDefault();return false});document.getElementById("sync").addEventListener("click",function(e){if(!p.wallet.address&&!p.isSyncingWallet){p.walletClient.requestPermissions().then(function(){return p.walletClient.getAccounts()}).then(function(e){p.wallet=e[0];p.isSyncingWallet=false}).catch(console.log)}else if(p.wallet.address&&!p.isSyncingWallet){p.isSyncingWallet=true;p.walletClient.removeAllAccounts().then(function(){p.wallet={};R();document.getElementById("main-content").innerHTML="";p=JSON.parse(JSON.stringify(d));p.isSyncingWallet=false;p.walletClient=r;H()}).catch(console.log)}});document.getElementById("increase-items-per-page").addEventListener("click",function(e){O(1)});document.getElementById("decrease-items-per-page").addEventListener("click",function(e){O(0)});var e=function(e){if(Array.prototype.slice.call(e.target.classList,0).indexOf("disabled")!==-1){e.stopPropagation();e.preventDefault();return false}document.getElementById("next-page-controls").classList.add("hidden");N(p.galleryJSON)};document.getElementById("next-page").addEventListener("click",e);document.getElementById("next-page-mobile").addEventListener("click",e);var i=function(e){if(Array.prototype.slice.call(e.target.classList,0).indexOf("disabled")!==-1){e.stopPropagation();e.preventDefault();return false}if(p.pageSkips.length){p.skipCounts=p.pageSkips.splice(p.pageSkips.length-2,2)[0]}else{U()}document.getElementById("next-page-controls").classList.add("hidden");N(p.galleryJSON)};document.getElementById("previous-page").addEventListener("click",i);document.getElementById("previous-page-mobile").addEventListener("click",i)}function x(e){if(e){document.body.classList.add("night");p.session.nightModeActive=true}else{document.body.classList.remove("night");p.session.nightModeActive=false}D()}function A(){document.getElementById("bg-color-picker-menu").classList.remove("hidden");document.getElementById("hex-color-picker-container").classList.remove("hidden")}function P(s){const e=document.createElement("div");e.classList.add("objkt-container");const t=document.createElement("div");t.classList.add("preview");t.addEventListener("click",function(){var e=p.session.viewerBgColor;var t=window.location.href.split("?")[0].replace("#","")+"?ipfs="+encodeURIComponent(s.gatewayUri)+"&type="+encodeURIComponent(s.type)+"&title="+encodeURIComponent(s.name)+"&issuer="+encodeURIComponent(s.issuer.handle)+"&night="+encodeURIComponent(p.session.nightModeActive)+"&bg="+encodeURIComponent(e);var n="directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no";window.open(t,Date.now().toString(),n)});const n=document.createElement("div");n.style.backgroundImage="url("+s.displayImgUri+")";n.classList.add("resource");const i=document.createElement("div");i.classList.add("objkt-metadata");const a=document.createElement("a");a.classList.add("artist");a.setAttribute("href",s.platformIssuerUri);a.setAttribute("target","blank");a.innerText="by "+s.issuer.handle;const o=document.createElement("a");o.classList.add("title");o.setAttribute("href",s.platformUri);o.setAttribute("target","blank");o.innerText=s.name;const r=document.createElement("a");r.classList.add("ipfs-link");r.setAttribute("href",s.ipfsLink);r.setAttribute("target","blank");r.innerText=s.ipfsLink.substr(0,20)+"...";const l=document.createElement("a");l.classList.add("gateway-link");l.setAttribute("href",s.gatewayUri);l.setAttribute("target","blank");l.innerText=s.gatewayUri.substr(0,30)+"...";const d=document.createElement("a");d.classList.add("objkt-com-link");d.setAttribute("target","blank");d.setAttribute("href",s.objktComLink);d.innerText=s.objktComLink.substr(0,30)+"...";var c=document.createElement("div");c.innerText="üñºÔ∏è";c.classList.add("objkt-gallery-settings");c.addEventListener("click",function(){j(s)});i.appendChild(o);i.appendChild(document.createElement("br"));i.appendChild(a);i.appendChild(document.createElement("br"));i.appendChild(document.createElement("br"));i.appendChild(d);i.appendChild(l);i.appendChild(r);t.appendChild(n);if(!p.wallet.anonymous){i.appendChild(c)}e.appendChild(t);e.appendChild(i);return e}function _(e,n){var t=Math.floor(p.itemsPerPage*1.5);var s=[];var i=n&&n.hic;var a="";var o=true;if(Array.isArray(i)&&i.length){a=", _or: [";for(let e=0;e<i.length;e++){a+="{token_id: {_eq: "+i[e]+"}}";if(e<i.length-1){a+=","}}a+="]"}else if(Array.isArray(i)){o=false}s.push(!o?Promise.resolve(null):fetch("https://hdapi.teztools.io/v1/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\nquery collectorGallery($address: String!) {\n  hic_et_nunc_token_holder(limit: "+t+", offset: "+p.skipCounts.hic+', where: {holder_id: {_eq: $address}, token: {creator: {address: {_neq: $address}}}, quantity: {_gt: "0"} '+a+"}, order_by: {token_id: desc}) {\n    token {\n      id\n      artifact_uri\n      display_uri\n      thumbnail_uri\n      timestamp\n      mime\n      title\n      description\n      supply\n      royalties\n      creator {\n        address\n        name\n      }\n    }\n  }\n}\n",variables:{address:e},operationName:"collectorGallery"})}));var r=n&&n.fxhash;var l="(take: "+t+", skip: "+p.skipCounts.fxhash+")";var d=true;if(Array.isArray(r)&&r.length){l=""}else if(Array.isArray(r)){d=false}s.push(!d?Promise.resolve(null):fetch("https://api.fxhash.xyz/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({operationName:"Query",variables:{id:e},query:"query Query($id: String!) {\n  user(id: $id) {\n    id\n    objkts"+l+" {\n      id\n      assigned\n      iteration\n      owner {\n        id\n        name\n        flag\n        avatarUri\n        __typename\n      }\n      issuer {\n        name\n        flag\n        author {\n          id\n          name\n          flag\n          avatarUri\n          __typename\n        }\n        __typename\n      }\n      name\n      metadata\n      createdAt\n      offer {\n        id\n        price\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n"})}));return Promise.all(s).then(e=>Promise.all(e.map(e=>!e?e:e.json()))).then(([e,t])=>{if(n&&n.fxhash&&n.fxhash.length&&(t&&t.data&&t.data.user&&t.data.user.objkts&&t.data.user.objkts.length)){t.data.user.objkts=t.data.user.objkts.filter(function(e){return r.indexOf(e.id)!==-1});if(t.data.user.objkts.length<=p.skipCounts.fxhash){t.data.user.objkts=[]}else{t.data.user.objkts.splice(0,p.skipCounts.fxhash);if(t.data.user.objkts.length>p.itemsPerPage){p.skipCounts.fxhash=p.skipCounts.fxhash.slice(0,p.itemsPerPage)}}}return{hic:!e||!e.data||!e.data.hic_et_nunc_token_holder?[]:e.data.hic_et_nunc_token_holder.map(e=>{var t;var n;var s=e.token.mime.split("/")[0];if(s==="image"||s==="model"){n="https://cloudflare-ipfs.com/ipfs/"}else{n="https://ipfs.io/ipfs/"}t=s==="image"&&"image"||s==="video"&&"video"||s==="model"&&"model"||"web";return{count:e.token.supply,createdAt:e.token.timestamp,description:e.token.description,displayImgIpfsHash:e.token.display_uri.substr(7),displayImgUri:"https://cloudflare-ipfs.com/ipfs/"+e.token.display_uri.substr(7),gatewayUri:n+e.token.artifact_uri.substr(7),identifier:e.token.id,ipfsLink:e.token.artifact_uri,name:e.token.title,issuer:{address:e.token.creator.address,avatarIpfsHash:null,handle:e.token.creator.name||T(e.token.creator.address),platform:"HIC"},objktComLink:"https://objkt.com/asset/hicetnunc/"+e.token.id,platformUri:"https://hicetnunc.art/objkt/"+e.token.id,platformIssuerUri:"https://objkt.com/profile/"+e.token.creator.address+"/created/?fa2=KT1RJ6PbjHpwc3M5rw5s2Nbmefwbuwbdxton",resourceIpfsHash:e.token.artifact_uri.substr(7),type:t}}),fxhash:!t||!t.data||!t.data.user||!t.data.user.objkts?[]:t.data.user.objkts.map(e=>({count:null,createdAt:e.createdAt,description:e.metadata.description,displayImgIpfsHash:e.metadata.displayUri.substr(7),displayImgUri:"https://cloudflare-ipfs.com/ipfs/"+e.metadata.displayUri.substr(7),gatewayUri:"https://gateway.fxhash.xyz/ipfs/"+e.metadata.artifactUri.substr(7),identifier:e.id,ipfsLink:e.metadata.displayUri,issuer:{address:e.issuer.author.id,avatarIpfsHash:e.issuer.author.avatarUri.substr(7),handle:e.issuer.author.name||T(e.issuer.author.id),platform:"FXHASH"},name:e.name,objktComLink:"https://objkt.com/asset/fxhashgenesis/"+e.id,platformUri:"https://www.fxhash.xyz/gentk/"+e.id,platformIssuerUri:"https://www.fxhash.xyz/pkh/"+e.issuer.author.id,resourceIpfsHash:e.metadata.artifactUri.substr(7),type:"web"}))}}).then(e=>{return Object.values(e).reduce((e,t)=>e.concat(t),[]).sort(function(e,t){return new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()})}).then(e=>{if(!e.length){return false}if(e.length<=p.itemsPerPage){p.isLastPage=true}else{p.isLastPage=false}var t=e.slice(0,p.itemsPerPage);p.pageSkips.push(JSON.parse(JSON.stringify(p.skipCounts)));console.log("unincreased skip counts",p.skipCounts);for(let e=0;e<t.length;e++){var n=t[e];var s=n.issuer.platform.toLowerCase();p.skipCounts[s]+=1}console.log("increased skip counts",p.skipCounts);return t}).catch(console.log)}function T(e){return e.substr(0,5)+"..."+e.substr(e.substr.length-5,e.substr.length)}function O(e){const t=[10,25,50,100];const n=t.indexOf(p.itemsPerPage);const s=e&&n!==t.length-1;const i=!e&&n!==0;let a;if(s){a=t[n+1]}else if(i){a=t[n-1]}if(a){p.session.itemsPerPage=a;D();U();p.itemsPerPage=a;p.pageSkips=[];document.getElementById("items-per-page").innerText=a;N(p.galleryJSON)}}function U(){var t=Object.keys(p.skipCounts);for(let e=0;e<t.length;e++){p.skipCounts[t[e]]=0}}function j(e){document.getElementById("gallery-list-container").classList.remove("hidden");q(e)}function N(e){const n=document.getElementById("main-content");n.innerHTML="";return _(p.wallet.address,e).then(t=>{if(!t){return false}for(let e=0;e<t.length;e++){n.appendChild(P(t[e]))}J();if(p.isLastPage){document.getElementById("next-page").classList.add("disabled");document.getElementById("next-page-mobile").classList.add("disabled")}else{document.getElementById("next-page").classList.remove("disabled");document.getElementById("next-page-mobile").classList.remove("disabled")}if(p.pageSkips.length===1){document.getElementById("previous-page").classList.add("disabled");document.getElementById("previous-page-mobile").classList.add("disabled")}else{document.getElementById("previous-page").classList.remove("disabled");document.getElementById("previous-page-mobile").classList.remove("disabled")}}).then(console.log,console.log)}function M(){document.getElementById("sync").innerText="unsync";document.getElementById("wallet-nav").classList.remove("hidden")}function R(){document.getElementById("sync").innerText="sync";document.getElementById("wallet-nav").classList.add("hidden")}function J(){document.getElementById("next-page-controls").classList.remove("hidden");document.getElementById("page-control-nav").classList.remove("hidden")}function H(){document.getElementById("next-page-controls").classList.add("hidden");document.getElementById("page-control-nav").classList.add("hidden")}function q(n){var e=document.getElementById("gallery-link-container");e.innerHTML="";var s=Object.keys(p.session.galleryMap);for(let t=0;t<s.length;t++){var i=p.session.galleryMap[s[t]];var a=document.createElement("div");a.classList.add("gallery-link-container");var o="gallery-link-"+s[t];a.setAttribute("id",o);var r=document.createElement("a");r.classList.add("remove-gallery");r.setAttribute("href","#");r.setAttribute("data-gallery-key",s[t]);r.innerText="üóëÔ∏è";r.addEventListener("click",function(){delete p.session.galleryMap[s[t]];D();q()});var l=document.createElement("a");l.classList.add("gallery-link");l.setAttribute("href","#");l.setAttribute("data-gallery-key",s[t]);l.innerText=i.displayName;l.addEventListener("click",function(){window.location.href=window.location.href.split("#")[0].split("?")[0]+"?tz="+p.wallet.address+"&gallery="+encodeURIComponent(JSON.stringify(p.session.galleryMap[s[t]]))});if(!n){a.appendChild(r)}else{var d=p.session.galleryMap[s[t]];var c=n.issuer.platform.toLowerCase();var u=d[c].indexOf(n.identifier);if(u!==-1){var m=document.createElement("a");m.classList.add("remove-from-gallery");m.setAttribute("href","#");m.setAttribute("data-gallery-key",s[t]);m.innerText="‚≠ï";m.addEventListener("click",function(e){p.session.galleryMap[s[t]][c].splice(u,1);D();q(n);e.preventDefault()});a.appendChild(m)}else{var g=document.createElement("a");g.classList.add("remove-from-gallery");g.setAttribute("href","#");g.setAttribute("data-gallery-key",s[t]);g.innerText="‚úÖ";g.addEventListener("click",function(e){p.session.galleryMap[s[t]][c].push(n.identifier);D();q(n);document.getElementById("gallery-list-container").classList.add("hidden");e.preventDefault()});a.appendChild(g)}}a.appendChild(l);e.appendChild(a)}}function D(){o[p.wallet.address||"default"]=p.session;console.log("storing session",o);window.localStorage.setItem(n,JSON.stringify(o))}})();