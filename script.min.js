(function(){var e=10;var t="black";var p="objktiv-session";var r=["red","orange","yellow","green","blue","purple","black","white"];var n={nightModeActive:false,itemsPerPage:e,viewerBgColor:t,galleryIndex:0,galleryMap:{}};var a=document.getElementById("next-page-control-flare");function i(){if(a){var e=h();if(e!==a.innerText){a.innerText=e}else{i()}}}setInterval(i,200);var f=window.localStorage.getItem(p);if(!f){window.localStorage.setItem(p,JSON.stringify(n));f=n}else{f=JSON.parse(f);if(f.nightModeActive){document.body.classList.add("night")}if(f.itemsPerPage){document.getElementById("items-per-page").innerText=f.itemsPerPage}else{f.itemsPerPage=e}}var o=beacon.DAppClient;var y={wallet:null,isSyncingWallet:true,itemsPerPage:f.itemsPerPage,page:0};w();const l=new URLSearchParams(window.location.search);const s=Object.fromEntries(l.entries());if(s.tz){y.wallet={address:s.tz,anonymous:true};var d;if(s.gallery){d=decodeURIComponent(s.gallery);y.galleryJSON=d=JSON.parse(d)}S(d).then(console.log,console.log);document.getElementById("header-cta").classList.remove("hidden");document.getElementById("sync").classList.add("hidden");document.getElementById("galleries-link").classList.add("hidden");document.getElementById("wallet-lookup-container").classList.add("hidden")}else if(s.ipfs){if(s.title){console.log(s.title);document.title=s.title;document.getElementById("objkt-name").innerHTML=s.title}if(s.issuer){document.getElementById("objkt-name").innerHTML=document.getElementById("objkt-name").innerHTML+'<br id="objkt-title-break">by '+s.issuer}if(s.night){k(s.night==="true")}var c=s.bg||f.viewerBgColor||t;document.getElementById("selected-bg-color").style.background=c;document.getElementById("viewer-window-content").style.background=c;for(let e=0;e<r.length;e++){v(r[e])}document.getElementById("nav").classList.add("hidden");document.getElementById("header").classList.add("hidden");document.getElementById("footer").classList.add("hidden");document.getElementById("footer-push").classList.add("hidden");document.getElementById("viewer-window").classList.remove("hidden");var u=new XMLHttpRequest;var m=s.ipfs;u.open("HEAD",m,true);u.send();u.onreadystatechange=function(){if(this.readyState==this.HEADERS_RECEIVED){var e=u.getResponseHeader("content-type");console.log(e);const n={image:function(){return'<div id="image-resource" style="background-image: url('+m+')"></div>'},video:function(){return'<video id="video-resource" autoplay loop controls muted><source src="'+m+'" type="'+e+'"></video>'},iframe:function(){return'<iframe id="interactive-resource" src="'+m+'"/>'}};var t=e.split("/")[0];document.getElementById("viewer-window-content").innerHTML=(n[t]||n.iframe)()}};return true}else{var g=new o({name:"OBJKTIV",eventHandlers:{ACTIVE_ACCOUNT_SET:{handler:function(n){console.log("ACTIVE ACCOUNT SET");return new Promise(function(e,t){y.isSyncingWallet=false;if(n&&n.address){y.wallet=n;A();return S().then(e,t)}e()}).then(console.log,console.log)}}}})}function h(){var e=["üå¥","üçï","üéôÔ∏è","‚ù§Ô∏è","üî•","üîà","üìª","üéµ","üé∂"];return e[Math.floor(Math.random()*e.length)]}function v(i){const e=document.getElementById("bg-color-picker-menu");const t=document.createElement("div");t.style.background=i;t.classList.add("color-option");t.setAttribute("data-color",i);t.addEventListener("click",function(){f.viewerBgColor=i;window.localStorage.setItem(p,JSON.stringify(f));document.getElementById("viewer-window-content").style.background=i;document.getElementById("selected-bg-color").style.background=i;var e=window.location.href.split("?");var t=e[1];var n=null;if(t){t=new URLSearchParams(t);t.delete("bg");var a=i;if(r.indexOf(a)===-1){a="#"+a}n=e[0]+"?"+t.toString()+"&bg="+encodeURIComponent(a);window.history.pushState({},document.title,n)}b()});e.appendChild(t)}function b(){y.viewerColorMenuOpen=false;document.getElementById("bg-color-picker-menu").classList.add("hidden");document.getElementById("hex-color-picker-container").classList.add("hidden")}function w(){document.getElementById("galleries-link").addEventListener("click",function(e){C();e.preventDefault()});document.getElementById("gallery-list-exit").addEventListener("click",function(){document.getElementById("gallery-list-container").classList.add("hidden")});document.getElementById("new-gallery-submit").addEventListener("click",function(e){var t=document.getElementById("new-gallery-input").textContent;if(t){document.getElementById("new-gallery-input").textContent="";f.galleryMap[f.galleryIndex]={displayName:t,hic:[],fxhash:[]};f.galleryIndex+=1;window.localStorage.setItem(p,JSON.stringify(f));O()}e.stopPropagation();e.preventDefault()});document.getElementById("selected-bg-color").addEventListener("click",function(e){if(!y.viewerColorMenuOpen){E();y.viewerColorMenuOpen=true}else{b()}e.stopPropagation()});document.getElementById("hex-color-picker-submit").addEventListener("click",function(){let e=document.getElementById("hex-color-picker").textContent;e=e.replace("#","");if(e.length===3||e.length===6){f.viewerBgColor="#"+e;document.getElementById("selected-bg-color").style.background="#"+e;document.getElementById("viewer-window-content").style.background="#"+e;window.localStorage.setItem(p,JSON.stringify(f));v("#"+e);var t=window.location.href.split("?");var n=t[1];var a=null;if(n){n=new URLSearchParams(n);n.delete("bg");var i=e;if(r.indexOf(i)===-1){i="#"+i}a=t[0]+"?"+n.toString()+"&bg="+encodeURIComponent(i);window.history.pushState({},document.title,a)}}b()});document.getElementById("wallet-lookup-input").addEventListener("input",function(){const e=document.getElementById("wallet-lookup-input").innerText;document.getElementById("wallet-lookup-input").innerHTML="";document.getElementById("wallet-lookup-input").innerText="";document.getElementById("wallet-lookup-input").innerText=e.replace("\n","")},false);document.getElementById("wallet-lookup-submit").addEventListener("click",function(){var e=document.getElementById("wallet-lookup-input").textContent;if(e){window.location.href=window.location.href.split("?")[0].replace("#","")+"?tz="+e}});document.getElementById("exit-anon").addEventListener("click",function(e){e.preventDefault();window.location.href=window.location.href.split("?")[0]});document.getElementById("day-night-toggle").addEventListener("click",function(e){if((document.body.getAttribute("class")||"").indexOf("night")===-1){k(true)}else{k(false)}e.preventDefault();return false});document.getElementById("sync").addEventListener("click",function(e){if(!y.wallet&&!y.isSyncingWallet){y.isSyncingWallet=true;g.requestPermissions().then(function(){return g.getAccounts()}).then(function(e){y.wallet=e[0];y.isSyncingWallet=false}).catch(console.log)}else if(y.wallet&&!y.isSyncingWallet){y.isSyncingWallet=true;g.removeAllAccounts().then(function(){y.wallet=null;y.isSyncingWallet=false;_();document.getElementById("main-content").innerHTML="";f=n;window.localStorage.removeItem(p);T()}).catch(console.log)}});document.getElementById("increase-items-per-page").addEventListener("click",function(e){x(1)});document.getElementById("decrease-items-per-page").addEventListener("click",function(e){x(0)});var e=function(e){if(Array.prototype.slice.call(e.target.classList,0).indexOf("disabled")!==-1){e.stopPropagation();e.preventDefault();return false}y.page=y.page+1;document.getElementById("next-page-controls").classList.add("hidden");S(y.galleryJSON)};document.getElementById("next-page").addEventListener("click",e);document.getElementById("next-page-mobile").addEventListener("click",e);var t=function(e){if(y.page===0){e.stopPropagation();e.preventDefault();return false}y.page-=1;document.getElementById("next-page-controls").classList.add("hidden");S(y.galleryJSON)};document.getElementById("previous-page").addEventListener("click",t);document.getElementById("previous-page-mobile").addEventListener("click",t)}function k(e){if(e){document.body.classList.add("night");f.nightModeActive=true}else{document.body.classList.remove("night");f.nightModeActive=false}window.localStorage.setItem(p,JSON.stringify(f))}function E(){document.getElementById("bg-color-picker-menu").classList.remove("hidden");document.getElementById("hex-color-picker-container").classList.remove("hidden")}function I(i){const e=document.createElement("div");e.classList.add("objkt-container");const t=document.createElement("div");t.classList.add("preview");t.addEventListener("click",function(){var e=window.localStorage.getItem(p);if(e){e=JSON.parse(e)}var t=e.viewerBgColor||f.viewerBgColor;var n=window.location.href.split("?")[0].replace("#","")+"?ipfs="+encodeURIComponent(i.gatewayUri)+"&title="+encodeURIComponent(i.name)+"&issuer="+encodeURIComponent(i.issuer.handle)+"&night="+encodeURIComponent(f.nightModeActive)+"&bg="+encodeURIComponent(t);var a="directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no";window.open(n,Date.now().toString(),a)});const n=document.createElement("div");n.style.backgroundImage="url("+i.displayImgUri+")";n.classList.add("resource");const a=document.createElement("div");a.classList.add("objkt-metadata");const r=document.createElement("a");r.classList.add("artist");r.setAttribute("href",i.platformIssuerUri);r.setAttribute("target","blank");r.innerText="by "+i.issuer.handle;const o=document.createElement("a");o.classList.add("title");o.setAttribute("href",i.platformUri);o.setAttribute("target","blank");o.innerText=i.name;const l=document.createElement("a");l.classList.add("ipfs-link");l.setAttribute("href",i.ipfsLink);l.setAttribute("target","blank");l.innerText=i.ipfsLink.substr(0,20)+"...";const s=document.createElement("a");s.classList.add("gateway-link");s.setAttribute("href",i.gatewayUri);s.setAttribute("target","blank");s.innerText=i.gatewayUri.substr(0,30)+"...";const d=document.createElement("a");d.classList.add("objkt-com-link");d.setAttribute("target","blank");d.setAttribute("href",i.objktComLink);d.innerText=i.objktComLink.substr(0,30)+"...";var c=document.createElement("div");c.innerText="üñºÔ∏è";c.classList.add("objkt-gallery-settings");c.addEventListener("click",function(){C(i)});a.appendChild(o);a.appendChild(document.createElement("br"));a.appendChild(r);a.appendChild(document.createElement("br"));a.appendChild(document.createElement("br"));a.appendChild(d);a.appendChild(s);a.appendChild(l);t.appendChild(n);if(!y.wallet.anonymous){a.appendChild(c)}e.appendChild(t);e.appendChild(a);return e}function L(e,n){const a=y.page?y.page*y.itemsPerPage:0;var t=n&&n.hic;var i="";if(Array.isArray(t)){i=", _or: [";for(let e=0;e<t.length;e++){i+="{token_id: {_eq: "+t[e]+"}}";if(e<t.length-1){i+=","}}i+="]"}var r=n&&n.fxhash;var o="(take: "+y.itemsPerPage+", skip: "+a+")";if(Array.isArray(r)&&r.length){o=""}return Promise.all([fetch("https://hdapi.teztools.io/v1/graphql",{method:"POST",body:JSON.stringify({query:'\nquery collectorGallery($address: String!) {\n  hic_et_nunc_token_holder(where: {holder_id: {_eq: $address}, token: {creator: {address: {_neq: $address}}}, quantity: {_gt: "0"} '+i+"}, order_by: {token_id: desc}) {\n    token {\n      id\n      artifact_uri\n      display_uri\n      thumbnail_uri\n      timestamp\n      mime\n      title\n      description\n      supply\n      royalties\n      creator {\n        address\n        name\n      }\n    }\n  }\n}\n",variables:{address:e},operationName:"collectorGallery"})}),fetch("https://api.fxhash.xyz/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({operationName:"Query",variables:{id:e},query:"query Query($id: String!) {\n  user(id: $id) {\n    id\n    objkts"+o+" {\n      id\n      assigned\n      iteration\n      owner {\n        id\n        name\n        flag\n        avatarUri\n        __typename\n      }\n      issuer {\n        name\n        flag\n        author {\n          id\n          name\n          flag\n          avatarUri\n          __typename\n        }\n        __typename\n      }\n      name\n      metadata\n      createdAt\n      offer {\n        id\n        price\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n"})})]).then(e=>Promise.all(e.map(e=>e.json()))).then(([e,t])=>{if(n){if(!n.fxhash.length){t=[]}else if(t&&t.data&&t.data.user&&t.data.user.objkts&&t.data.user.objkts.length){t.data.user.objkts=t.data.user.objkts.filter(function(e){return r.indexOf(e.id)!==-1})}}return{hic:!e||!e.data||!e.data.hic_et_nunc_token_holder?[]:e.data.hic_et_nunc_token_holder.sort((e,t)=>Date.now(t.token.timestamp)-Date.now(e.token.timestamp)).slice(a?a-1:0,a+y.itemsPerPage*2).map(e=>({count:e.token.supply,createdAt:e.token.timestamp,description:e.token.description,displayImgIpfsHash:e.token.display_uri.substr(7),displayImgUri:"https://cloudflare-ipfs.com/ipfs/"+e.token.display_uri.substr(7),gatewayUri:(e.token.mime.split("/")[0]==="video"?"https://ipfs.io/ipfs/":"https://cloudflare-ipfs.com/ipfs/")+e.token.artifact_uri.substr(7),identifier:e.token.id,ipfsLink:e.token.artifact_uri,name:e.token.title,issuer:{address:e.token.creator.address,avatarIpfsHash:null,handle:e.token.creator.name||B(e.token.creator.address),platform:"HIC"},objktComLink:"https://objkt.com/asset/hicetnunc/"+e.token.id,platformUri:"https://hicetnunc.art/objkt/"+e.token.id,platformIssuerUri:"https://objkt.com/profile/"+e.token.creator.address+"/created/?fa2=KT1RJ6PbjHpwc3M5rw5s2Nbmefwbuwbdxton",resourceIpfsHash:e.token.artifact_uri.substr(7)})),fxhash:!t||!t.data||!t.data.user||!t.data.user.objkts?[]:t.data.user.objkts.map(e=>({count:null,createdAt:e.createdAt,description:e.metadata.description,displayImgIpfsHash:e.metadata.displayUri.substr(7),displayImgUri:"https://cloudflare-ipfs.com/ipfs/"+e.metadata.displayUri.substr(7),gatewayUri:"https://gateway.fxhash.xyz/ipfs/"+e.metadata.artifactUri.substr(7),identifier:e.id,ipfsLink:e.metadata.displayUri,issuer:{address:e.issuer.author.id,avatarIpfsHash:e.issuer.author.avatarUri.substr(7),handle:e.issuer.author.name||B(e.issuer.author.id),platform:"FXHASH"},name:e.name,objktComLink:"https://objkt.com/asset/fxhashgenesis/"+e.id,platformUri:"https://www.fxhash.xyz/gentk/"+e.id,platformIssuerUri:"https://www.fxhash.xyz/pkh/"+e.issuer.author.id,resourceIpfsHash:e.metadata.artifactUri.substr(7)}))}}).catch(console.log)}function B(e){return e.substr(0,5)+"..."+e.substr(e.substr.length-5,e.substr.length)}function x(e){const t=[10,25,50,100];const n=t.indexOf(y.itemsPerPage);const a=e&&n!==t.length-1;const i=!e&&n!==0;let r;if(a){r=t[n+1]}else if(i){r=t[n-1]}if(r){y.itemsPerPage=r;y.page=0;document.getElementById("items-per-page").innerText=r;f.itemsPerPage=r;window.localStorage.setItem(p,JSON.stringify(f));S()}}function C(e){document.getElementById("gallery-list-container").classList.remove("hidden");O(e)}function S(e){const n=document.getElementById("main-content");n.innerHTML="";let a=false;return L(y.wallet.address,e).then(e=>{return Object.values(e).reduce((e,t)=>e.concat(t),[]).sort(function(e,t){return new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()})}).then(e=>{if(!e.length){return false}if(e.length<=y.itemsPerPage){a=true}const t=e.slice(0,y.itemsPerPage);for(let e=0;e<t.length;e++){n.appendChild(I(t[e]))}return true}).then(e=>{if(!e){return false}P();if(a){document.getElementById("next-page").classList.add("disabled");document.getElementById("next-page").classList.add("disabled")}else{document.getElementById("next-page").classList.remove("disabled");document.getElementById("next-page").classList.remove("disabled")}if(y.page===0){document.getElementById("previous-page").classList.add("disabled");document.getElementById("previous-page").classList.add("disabled")}else{document.getElementById("previous-page").classList.remove("disabled");document.getElementById("previous-page").classList.remove("disabled")}}).then(console.log,console.log)}function A(){document.getElementById("sync").innerText="unsync";document.getElementById("wallet-nav").classList.remove("hidden")}function _(){document.getElementById("sync").innerText="sync";document.getElementById("wallet-nav").classList.add("hidden")}function P(){document.getElementById("next-page-controls").classList.remove("hidden");document.getElementById("page-control-nav").classList.remove("hidden")}function T(){document.getElementById("next-page-controls").classList.add("hidden");document.getElementById("page-control-nav").classList.add("hidden")}function O(n){var e=document.getElementById("gallery-link-container");e.innerHTML="";var a=Object.keys(f.galleryMap);for(let t=0;t<a.length;t++){var i=f.galleryMap[a[t]];var r=document.createElement("div");r.classList.add("gallery-link-container");var o="gallery-link-"+a[t];r.setAttribute("id",o);var l=document.createElement("a");l.classList.add("remove-gallery");l.setAttribute("href","#");l.setAttribute("data-gallery-key",a[t]);l.innerText="üóëÔ∏è";l.addEventListener("click",function(){delete f.galleryMap[a[t]];window.localStorage.setItem(p,JSON.stringify(f));O()});var s=document.createElement("a");s.classList.add("gallery-link");s.setAttribute("href","#");s.setAttribute("data-gallery-key",a[t]);s.innerText=i.displayName;s.addEventListener("click",function(){window.location.href=window.location.href.split("#")[0].split("?")[0]+"?tz="+y.wallet.address+"&gallery="+encodeURIComponent(JSON.stringify(f.galleryMap[a[t]]))});if(!n){r.appendChild(l)}else{var d=f.galleryMap[a[t]];var c=n.issuer.platform.toLowerCase();var u=d[c].indexOf(n.identifier);if(u!==-1){var m=document.createElement("a");m.classList.add("remove-from-gallery");m.setAttribute("href","#");m.setAttribute("data-gallery-key",a[t]);m.innerText="‚≠ï";m.addEventListener("click",function(e){f.galleryMap[a[t]][c].splice(u,1);window.localStorage.setItem(p,JSON.stringify(f));O(n);e.preventDefault()});r.appendChild(m)}else{var g=document.createElement("a");g.classList.add("remove-from-gallery");g.setAttribute("href","#");g.setAttribute("data-gallery-key",a[t]);g.innerText="‚úÖ";g.addEventListener("click",function(e){f.galleryMap[a[t]][c].push(n.identifier);window.localStorage.setItem(p,JSON.stringify(f));O(n);e.preventDefault()});r.appendChild(g)}}r.appendChild(s);e.appendChild(r)}}})();